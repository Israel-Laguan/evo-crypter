<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>evo-crypter: Adding New Command-Line Flags to evo-crypter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">evo-crypter
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2FLAGS.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Adding New Command-Line Flags to evo-crypter</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md22"></a> This tutorial explains how to add new command-line flags to <code>evo-crypter</code>. The project uses a lookup table approach, implemented in <code><a class="el" href="cli_8c.html">src/config/cli.c</a></code>, which makes adding new flags straightforward and organized.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Understanding the Structure</h1>
<p>The core of the flag handling mechanism is the <code><a class="el" href="structFlagHandler.html">FlagHandler</a></code> struct and the <code>flag_handlers</code> array:</p>
<div class="fragment"><div class="line"><span class="comment">// In src/config/cli.c</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *short_name;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *long_name;</div>
<div class="line">    void (*handler)(<a class="code hl_struct" href="structConfig.html">Config</a> *config, <span class="keywordtype">char</span> *value);</div>
<div class="line">} <a class="code hl_struct" href="structFlagHandler.html">FlagHandler</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structFlagHandler.html">FlagHandler</a> <a class="code hl_variable" href="cli_8c.html#a3007be895ef5156ae72ee895446e3b07">flag_handlers</a>[] = {</div>
<div class="line">    <span class="comment">// ... existing flags ...</span></div>
<div class="line">    {NULL, NULL, NULL} <span class="comment">// Sentinel value - don&#39;t remove!</span></div>
<div class="line">};</div>
<div class="ttc" id="acli_8c_html_a3007be895ef5156ae72ee895446e3b07"><div class="ttname"><a href="cli_8c.html#a3007be895ef5156ae72ee895446e3b07">flag_handlers</a></div><div class="ttdeci">FlagHandler flag_handlers[]</div><div class="ttdoc">Array of FlagHandler structs, mapping flag names to handler functions.</div><div class="ttdef"><b>Definition</b> cli.c:80</div></div>
<div class="ttc" id="astructConfig_html"><div class="ttname"><a href="structConfig.html">Config</a></div><div class="ttdoc">Represents the program's configuration settings.</div><div class="ttdef"><b>Definition</b> mod.h:24</div></div>
<div class="ttc" id="astructFlagHandler_html"><div class="ttname"><a href="structFlagHandler.html">FlagHandler</a></div><div class="ttdef"><b>Definition</b> cli.c:71</div></div>
</div><!-- fragment --><ul>
<li>**<code>short_name</code>:** The short, one-character version of the flag (e.g., <code>-i</code>).</li>
<li>**<code>long_name</code>:** The long, descriptive version of the flag (e.g., <code>--input</code>).</li>
<li>**<code>handler</code>:** A function pointer to the function that will process the flag's value (if any).</li>
</ul>
<h1><a class="anchor" id="autotoc_md24"></a>
Steps to Add a New Flag</h1>
<ol type="1">
<li><b>Choose Short and Long Names:</b><ul>
<li><b>Short Name:</b><ul>
<li>Choose a <b>single, unique character</b>. Avoid letters already used by other flags.</li>
<li>If you run out of letters you can use numbers or symbols</li>
<li><b>To avoid clashes</b>, check the existing <code>flag_handlers</code> array in <code><a class="el" href="cli_8c.html">cli.c</a></code>.</li>
</ul>
</li>
<li><b>Long Name:</b><ul>
<li>Choose a descriptive name, typically starting with two dashes (e.g., <code>--my-flag</code>).</li>
<li>Long names are less prone to clashes, but it's still good practice to ensure uniqueness.</li>
</ul>
</li>
</ul>
</li>
<li><b>Create a Handler Function:</b><ul>
<li>Create a new function in <code><a class="el" href="cli_8c.html">src/config/cli.c</a></code> to handle the flag's logic.</li>
<li><p class="startli">The function must have the following signature:</p>
<p class="startli"><code>c void handle_my_new_flag(Config *config, char *value); </code></p>
</li>
<li>**<code>config</code>:** A pointer to the <code><a class="el" href="structConfig.html" title="Represents the program&#39;s configuration settings.">Config</a></code> struct where you'll store the flag's value.</li>
<li>**<code>value</code>:** A string containing the value associated with the flag (or <code>NULL</code> for boolean flags).</li>
</ul>
</li>
<li><b>Add an Entry to <code>flag_handlers</code>:</b><ul>
<li><p class="startli">Add a new entry to the <code>flag_handlers</code> array in <code><a class="el" href="cli_8c.html">cli.c</a></code>:</p>
<p class="startli"><code>c { "-x", "--my-flag", handle_my_new_flag }, </code></p>
</li>
<li>Replace <code>"-x"</code> and <code>"--my-flag"</code> with your chosen short and long names.</li>
<li>Replace <code>handle_my_new_flag</code> with the name of your handler function.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md25"></a>
Examples</h1>
<p>Here are three examples demonstrating how to add different types of flags:</p>
<h2><a class="anchor" id="autotoc_md26"></a>
1. Boolean Flag (e.g., &lt;tt&gt;--verbose&lt;/tt&gt;)</h2>
<p>A boolean flag doesn't take a value; its presence indicates <code>true</code>, and its absence indicates <code>false</code>.</p>
<p><b>Handler Function:</b></p>
<div class="fragment"><div class="line"><span class="comment">// in src/config/cli.c</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handle_verbose_flag(<a class="code hl_struct" href="structConfig.html">Config</a> *config, <span class="keywordtype">char</span> *value) {</div>
<div class="line">    <span class="comment">// No &#39;value&#39; is used for boolean flags.</span></div>
<div class="line">    config-&gt;verbose = <span class="keyword">true</span>; <span class="comment">// Add a &#39;verbose&#39; field (bool) to the Config struct in mod.h</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>**<code>flag_handlers</code> Entry:**</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;-v&quot;</span>, <span class="stringliteral">&quot;--verbose&quot;</span>, handle_verbose_flag</div>
<div class="line">},</div>
</div><!-- fragment --><p><b>Usage:</b></p>
<div class="fragment"><div class="line">./evo -i input.txt -g 1,2 -v  # Verbose mode enabled</div>
<div class="line">./evo --input input.txt --generations 1,2 --verbose # Same as above</div>
<div class="line">./evo -i input.txt -g 1,2  # Verbose mode disabled (default)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md27"></a>
2. String or Number Flag (e.g., &lt;tt&gt;--output &lt;filename&gt;&lt;/tt&gt; or &lt;tt&gt;--level &lt;number&gt;&lt;/tt&gt;)</h2>
<p>This type of flag takes a single string or number as its value.</p>
<p><b>Handler Function:</b></p>
<div class="fragment"><div class="line"><span class="comment">// in src/config/cli.c</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handle_output_flag(<a class="code hl_struct" href="structConfig.html">Config</a> *config, <span class="keywordtype">char</span> *value) {</div>
<div class="line">    config-&gt;output_file = strdup(value); <span class="comment">// Add &#39;output_file&#39; (char *) to Config in mod.h</span></div>
<div class="line">    <span class="keywordflow">if</span> (config-&gt;output_file == NULL) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;Error allocating memory for output file&quot;</span>);</div>
<div class="line">        config-&gt;<a class="code hl_variable" href="structConfig.html#a66fc8b5982e9a36eba7124ad5cf23e23">error</a> = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handle_level_flag(<a class="code hl_struct" href="structConfig.html">Config</a> *config, <span class="keywordtype">char</span> *value) {</div>
<div class="line">    config-&gt;level = atoi(value); <span class="comment">// Add &#39;level&#39; (int) to Config in mod.h</span></div>
<div class="line">    <span class="keywordflow">if</span> (config-&gt;level &lt; 0) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Error: Level must be a non-negative number.\n&quot;</span>);</div>
<div class="line">        config-&gt;<a class="code hl_variable" href="structConfig.html#a66fc8b5982e9a36eba7124ad5cf23e23">error</a> = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="astructConfig_html_a66fc8b5982e9a36eba7124ad5cf23e23"><div class="ttname"><a href="structConfig.html#a66fc8b5982e9a36eba7124ad5cf23e23">Config::error</a></div><div class="ttdeci">bool error</div><div class="ttdef"><b>Definition</b> mod.h:29</div></div>
</div><!-- fragment --><p>**<code>flag_handlers</code> Entry:**</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;-o&quot;</span>, <span class="stringliteral">&quot;--output&quot;</span>, handle_output_flag</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;-l&quot;</span>, <span class="stringliteral">&quot;--level&quot;</span>, handle_level_flag</div>
<div class="line">},</div>
</div><!-- fragment --><p><b>Usage:</b></p>
<div class="fragment"><div class="line">./evo -i input.txt -g 1,2 -o output.txt</div>
<div class="line">./evo --input input.txt --generations 1,2 --output output.txt</div>
<div class="line">./evo -i input.txt -g 1,2 -l 3</div>
<div class="line">./evo --input input.txt --generations 1,2 --level 3</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
3. Array/List Flag (e.g., &lt;tt&gt;--exclude &lt;item1,item2,...&gt;&lt;/tt&gt;)</h2>
<p>This is a more advanced case where you want to accept a comma-separated list of values.</p>
<p><b>Handler Function:</b></p>
<div class="fragment"><div class="line"><span class="comment">// in src/config/cli.c</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handle_exclude_flag(<a class="code hl_struct" href="structConfig.html">Config</a> *config, <span class="keywordtype">char</span> *value) {</div>
<div class="line">    <span class="comment">// Add &#39;exclude_list&#39; (char **) and &#39;exclude_count&#39; (int) to Config in mod.h</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> *token;</div>
<div class="line">    <span class="keywordtype">int</span> count = 0;</div>
<div class="line">    <span class="keywordtype">char</span> *value_copy = strdup(value); <span class="comment">// Create a copy to avoid modifying the original</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// First, count the number of items</span></div>
<div class="line">    token = strtok(value_copy, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span> (token != NULL) {</div>
<div class="line">        count++;</div>
<div class="line">        token = strtok(NULL, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    free(value_copy);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Now, allocate the array and store the items</span></div>
<div class="line">    config-&gt;exclude_list = malloc(count * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div>
<div class="line">    <span class="keywordflow">if</span> (config-&gt;exclude_list == NULL) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;Error allocating memory for exclude list&quot;</span>);</div>
<div class="line">        config-&gt;<a class="code hl_variable" href="structConfig.html#a66fc8b5982e9a36eba7124ad5cf23e23">error</a> = <span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    value_copy = strdup(value);</div>
<div class="line">    token = strtok(value_copy, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; token != NULL; i++){</div>
<div class="line">        config-&gt;exclude_list[i] = strdup(token);</div>
<div class="line">        <span class="keywordflow">if</span> (config-&gt;exclude_list[i] == NULL) {</div>
<div class="line">            perror(<span class="stringliteral">&quot;Error allocating memory for exclude item&quot;</span>);</div>
<div class="line">            config-&gt;<a class="code hl_variable" href="structConfig.html#a66fc8b5982e9a36eba7124ad5cf23e23">error</a> = <span class="keyword">true</span>;</div>
<div class="line">            <span class="comment">// Free previously allocated memory before returning</span></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; i; j++) {</div>
<div class="line">                free(config-&gt;exclude_list[j]);</div>
<div class="line">            }</div>
<div class="line">            free(config-&gt;exclude_list);</div>
<div class="line">            free(value_copy);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        token = strtok(NULL, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    config-&gt;exclude_count = count;</div>
<div class="line">    free(value_copy);</div>
<div class="line">}</div>
</div><!-- fragment --><p>**<code>flag_handlers</code> Entry:**</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;-e&quot;</span>, <span class="stringliteral">&quot;--exclude&quot;</span>, handle_exclude_flag</div>
<div class="line">},</div>
</div><!-- fragment --><p><b>Usage:</b></p>
<div class="fragment"><div class="line">./evo -i input.txt -g 1,2 -e item1,item2,item3</div>
<div class="line">./evo --input input.txt --generations 1,2 --exclude item1,item2,item3</div>
</div><!-- fragment --><p><b>Important Considerations for Array Flags:</b></p>
<ul>
<li><b>Memory Management:</b> Be careful to allocate and free memory properly to avoid memory leaks. In the <code>handle_exclude_flag</code> example, we use <code>strdup</code> to copy the items and <code>free</code> to release the memory later.</li>
<li><b>Error Handling:</b> Check for potential errors like memory allocation failures and handle them appropriately.</li>
<li><b>Freeing Memory:</b> Remember to free the dynamically allocated memory in your <code>free_config</code> function (in <code><a class="el" href="config_2mod_8c.html">src/config/mod.c</a></code>) when the program finishes.</li>
<li><b>Parsing:</b> You might need to use functions like <code>strtok</code> (as in the example) or other string manipulation techniques to parse the comma-separated list.</li>
</ul>
<h1><a class="anchor" id="autotoc_md29"></a>
Testing</h1>
<p>After adding a new flag:</p>
<ol type="1">
<li><b>Rebuild:</b> Run <code>make all</code> or <code>./scripts/build.sh</code> to rebuild the <code>evo</code> executable.</li>
<li><b>Test Thoroughly:</b> Test your new flag with different combinations of arguments to ensure it works as expected and doesn't interfere with other flags.</li>
</ol>
<p><b>Remember to:</b></p>
<ol type="1">
<li><b>Update <code><a class="el" href="config_2mod_8h.html" title="Defines the configuration structure and functions for evo-crypter.">src/config/mod.h</a></code>:</b> Add the new fields (e.g., <code>verbose</code>, <code>output_file</code>, <code>level</code>, <code>exclude_list</code>, <code>exclude_count</code>) to the <code><a class="el" href="structConfig.html" title="Represents the program&#39;s configuration settings.">Config</a></code> struct as shown in the examples.</li>
<li><p class="startli"><b>Update <code><a class="el" href="config_2mod_8c.html">src/config/mod.c</a></code>:</b> Add the logic for freeing the new allocated fields (if any) in your <code>free_config</code> function. For example, for the <code>exclude_list</code> field:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (config-&gt;exclude_list) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; config-&gt;exclude_count; i++) {</div>
<div class="line">        free(config-&gt;exclude_list[i]);</div>
<div class="line">    }</div>
<div class="line">    free(config-&gt;exclude_list);</div>
<div class="line">    config-&gt;exclude_list = NULL;</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md30"></a>
Conclusion</h1>
<p>This lookup table approach makes adding new command-line flags to <code>evo-crypter</code> a relatively simple and well-structured process. By following these guidelines, you can extend the functionality of <code>evo-crypter</code> in a maintainable and organized way. Remember to choose unique short names, create handler functions to manage the flag's logic, and add the corresponding entry to the <code>flag_handlers</code> table. Happy coding! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
